# ูููููุฉ ููุงุนุฏ ุงูุจูุงูุงุช (Database Architecture V16)

## ๐ ูุธุฑุฉ ุนุงูุฉ
ุชุนุชูุฏ MediSwitch ุนูู ุจููุฉ ุจูุงูุงุช ูุฌููุฉ (Hybrid Architecture) ุชุฌูุน ุจูู ุงูุฃุฏุงุก ุงูุนุงูู ููุชุฎุฒูู ุงููุญูู (`SQLite`) ูููุฉ ุงูุณุญุงุจุฉ ูููุฒุงููุฉ (`Cloudflare D1`). ุชู ุชุตููู ูุฐู ุงููููููุฉ ูุถูุงู ุงูุนูู ุจุฏูู ุฅูุชุฑูุช (Offline-First) ูุน ูุฏุฑุฉ ุงูุชุญุฏูุซ ุงููุณุชูุฑ.

---

## ๐๏ธ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ (Local Database)
- **ุงููุญุฑู**: `SQLite`
- **ุงููููุน**: ุฌูุงุฒ ุงููุณุชุฎุฏู (Mobile App).
- **ุงูุฅุตุฏุงุฑ**: V16 Schema.
- **ุงููุธููุฉ**: ุชุฎุฒูู ูุงูู ูุจูุงูุงุช ุงูุฃุฏููุฉ ูุงูุชูุงุนูุงุช ูุชูููู ุงูุจุญุซ ุงูููุฑู ุจุฏูู ุฅูุชุฑูุช.

### 2. ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุณุญุงุจูุฉ (Cloud Database)
- **ุงููุญุฑู**: `Cloudflare D1` (SQL at Edge).
- **ุงููููุน**: ุดุจูุฉ Cloudflare ุงูุนุงูููุฉ.
- **ุงููุธููุฉ**: ุงููุตุฏุฑ ุงูุญูููู ููุจูุงูุงุช (Source of Truth)ุ ุงุณุชูุจุงู ุงูุชุญุฏูุซุงุช ูู ููุญุฉ ุงูุชุญููุ ูุชูุฒูุนูุง ูููุณุชุฎุฏููู.

### 3. ุฎุท ุฃูุงุจูุจ ุงูุจูุงูุงุช (Data Pipeline)
- **ุงููุตุฏุฑ ุงูุฎุงู**: DDInter, DrugBank, DailyMed.
- **ุงููุนุงูุฌ (Processor)**: ุณูุฑุจุชุงุช Python (`populate_mediswitch_final.py`).
- **ุงููุตุฏุฑ ุงููุณูุท**: ูููุงุช SQL ูุฌุฒุฃุฉ (`d1_sql_chunks`).
- **ุงูุชุฒุงูู**: ุนุจุฑ GitHub Actions (High-Fidelity Sync).

### 4. ุงููููุงุช ุงููุตุฏุฑูุฉ (Source Files)
ุชุนุชูุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูู ุงููููุงุช ุงูุชุงููุฉ ููุท (ุญุณุจ ุงูููุฏ ุงููุนูู):

| ุงูููู | ุงูุงูุชุฏุงุฏ | ุงููุณุงุฑ | ุงููุตู |
| :--- | :--- | :--- | :--- |
| **Medicines Data** | `.csv` | `assets/meds.csv` | ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฃุฏููุฉ ุงููุตุฑูุฉ (23,000+ ุฏูุงุก) ูุชุดูู ุงูุฃุณุนุงุฑุ ุงูุดุฑูุงุชุ ูุงูููุงุฏ ุงููุนุงูุฉ. |
| **DDInter Database** | `.db` | `assets/external_research_data/ddinter_complete.db` | ูุงุนุฏุฉ ุจูุงูุงุช SQLite ุชุญุชูู ุนูู ุจูุงูุงุช DDInter 2.0 ุงููุงููุฉ (ุชูุงุนูุงุชุ ูุตูุ ุขููุงุช). |
| **Dosage Guidelines** | `.json` | `assets/data/dosage_guidelines.json` | ููู ูุญุชูู ุนูู ุฅุฑุดุงุฏุงุช ุงูุฌุฑุนุงุช ุงููุฌูุนุฉ ูู DailyMed ู Local Scraper ูุฌุฏูู `dosage_guidelines`. |

> **ููุงุญุธุฉ:** ูุชู ุฏูุฌ ูุฐู ุงููุตุงุฏุฑ ูู `mediswitch.db` ุนุจุฑ ุณูุฑุจุชุงุช ุงูุชุนุจุฆุฉ (`populate_mediswitch_final.py`).

---

## ๐๏ธ ุชูุงุตูู ุงูุฌุฏุงูู ุงููุงููุฉ (Full V16 Schema)

ูููุง ููู ุชูุซูู ุดุงูู ููู ุงูุฌุฏุงูู ูุงูุฃุนูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูุชุทุงุจู ุชูุงูุงู ูุน ููู `01_schema.sql`.

### 1. ุฌุฏูู ุงูุฃุฏููุฉ (`drugs`)
ุงูุฌุฏูู ุงููุฑูุฒู ููุฃุฏููุฉุ ูุฌูุน ุจูู ุจูุงูุงุช ุงูุณูู ุงููุญูู ูุงูุจูุงูุงุช ุงูุนุงูููุฉ.

| # | ุงูุนููุฏ | ุงูููุน | ุงููุตู |
| :--- | :--- | :--- | :--- |
| 1 | `id` | INTEGER PK | ุงููุนุฑู ุงููุฑูุฏ ููุฏูุงุก |
| 2 | `trade_name` | TEXT | ุงูุงุณู ุงูุชุฌุงุฑู (En) |
| 3 | `arabic_name` | TEXT | ุงูุงุณู ุงูุชุฌุงุฑู (Ar) |
| 4 | `price` | TEXT | ุณุนุฑ ุงูุฌูููุฑ ุงูุญุงูู |
| 5 | `old_price` | TEXT | ุงูุณุนุฑ ุงููุฏูู ููููุงุฑูุฉ |
| 6 | `category` | TEXT | ุงูุชุตููู ุงูุนูุงุฌู ุงูุฑุฆูุณู |
| 7 | `active` | TEXT | ุงููุงุฏุฉ ุงููุนุงูุฉ ุงูุฑุฆูุณูุฉ |
| 8 | `company` | TEXT | ุงูุดุฑูุฉ ุงููุตูุนุฉ |
| 9 | `dosage_form` | TEXT | ุงูุดูู ุงูุตูุฏูุงูู (En) |
| 10 | `dosage_form_ar` | TEXT | ุงูุดูู ุงูุตูุฏูุงูู (Ar) |
| 11 | `concentration` | REAL | ุชุฑููุฒ ุงููุงุฏุฉ ุงููุนุงูุฉ |
| 12 | `unit` | TEXT | ูุญุฏุฉ ุงูุชุฑููุฒ (mg, ml) |
| 13 | `usage` | TEXT | ุฏูุงุนู ุงูุงุณุชุนูุงู (ูุฎุชุตุฑ) |
| 14 | `pharmacology` | TEXT | ุงูุชุตููู ุงููุงุฑูุงููููุฌู |
| 15 | `barcode` | TEXT | ุงูุจุงุฑููุฏ ุงูุฏููู |
| 16 | `qr_code` | TEXT | ููุฏ QR |
| 17 | `visits` | INTEGER | ุนุฏุฏ ูุฑุงุช ุงูุนุฑุถ (Analytics) |
| 18 | `last_price_update` | TEXT | ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ ููุณุนุฑ |
| 19 | `updated_at` | INTEGER | ุทุงุจุน ุฒููู ูููุฒุงููุฉ |
| 20 | `indication` | TEXT | ุฏูุงุนู ุงูุงุณุชุนูุงู (ุชูุตููู) |
| 21 | `mechanism_of_action` | TEXT | ุขููุฉ ุงูุนูู |
| 22 | `pharmacodynamics` | TEXT | ุงูุฏููุงูููุง ุงูุฏูุงุฆูุฉ |
| 23 | `data_source_pharmacology` | TEXT | ูุตุฏุฑ ุงูุจูุงูุงุช ุงููุงุฑูุงููููุฌูุฉ |
| 24 | `has_drug_interaction` | INTEGER | ูุคุดุฑ ุชูุงุนูุงุช ุฏูุงุฆูุฉ (0/1) |
| 25 | `has_food_interaction` | INTEGER | ูุคุดุฑ ุชูุงุนูุงุช ุบุฐุงุฆูุฉ (0/1) |
| 26 | `has_disease_interaction` | INTEGER | ูุคุดุฑ ุชูุงุนูุงุช ูุฑุถูุฉ (0/1) |
| 27 | `description` | TEXT | ูุตู ูุตู ูุงูู ููุฏูุงุก |
| 28 | `atc_codes` | TEXT | ุฃููุงุฏ ุงูุชุตููู ุงูุชุดุฑูุญู (ATC) |
| 29 | `external_links` | TEXT | ุฑูุงุจุท ุฎุงุฑุฌูุฉ (JSON) |

### 2. ุฌุฏูู ุงูุชูุงุนูุงุช ุงูุฏูุงุฆูุฉ (`drug_interactions`)
ูุงุนุฏุฉ ููุงุนุฏ ุงูุชูุงุนูุงุช ุจูู ุงูููุงุฏ ุงููุนุงูุฉ.

| # | ุงูุนููุฏ | ุงูููุน | ุงููุตู |
| :--- | :--- | :--- | :--- |
| 1 | `id` | INTEGER PK | ูุนุฑู ุงูุชูุงุนู |
| 2 | `ingredient1` | TEXT | ุงูุทุฑู ุงูุฃูู (ุงููุงุฏุฉ ุงููุนุงูุฉ) |
| 3 | `ingredient2` | TEXT | ุงูุทุฑู ุงูุซุงูู (ุงููุงุฏุฉ ุงููุนุงูุฉ) |
| 4 | `severity` | TEXT | ูุณุชูู ุงูุฎุทูุฑุฉ (Major, Moderate, Minor) |
| 5 | `effect` | TEXT | ุงูุฃุซุฑ ุงููุงุชุฌ ุนู ุงูุชูุงุนู |
| 6 | `arabic_effect` | TEXT | ุงูุฃุซุฑ ุงููุงุชุฌ (ุจุงูุนุฑุจูุฉ) |
| 7 | `recommendation` | TEXT | ุงูุชูุตูุฉ ุงูุทุจูุฉ |
| 8 | `arabic_recommendation` | TEXT | ุงูุชูุตูุฉ ุงูุทุจูุฉ (ุจุงูุนุฑุจูุฉ) |
| 9 | `management_text` | TEXT | ููููุฉ ุฅุฏุงุฑุฉ ุงูุชูุงุนู ุณุฑูุฑูุงู |
| 10 | `mechanism_text` | TEXT | ุงูุขููุฉ ุงูุนูููุฉ ููุชูุงุนู |
| 11 | `alternatives_a` | TEXT | ุจุฏุงุฆู ููุชุฑุญุฉ ููุทุฑู ุงูุฃูู |
| 12 | `alternatives_b` | TEXT | ุจุฏุงุฆู ููุชุฑุญุฉ ููุทุฑู ุงูุซุงูู |
| 13 | `risk_level` | TEXT | ูุณุชูู ุงูุฎุทุฑ (ุชุตููู DDInter) |
| 14 | `ddinter_id` | TEXT | ุงููุนุฑู ูู ูุงุนุฏุฉ DDInter |
| 15 | `source` | TEXT | ูุตุฏุฑ ุงูุชูุงุนู |
| 16 | `type` | TEXT | ููุน ุงูุชูุงุนู |
| 17 | `metabolism_info` | TEXT | ูุนูููุงุช ุงูุฃูุถ |
| 18 | `source_url` | TEXT | ุฑุงุจุท ุงููุตุฏุฑ |
| 19 | `reference_text` | TEXT | ุงููุฑุฌุน ุงูุนููู |
| 20 | `updated_at` | INTEGER | ุทุงุจุน ุฒููู ูููุฒุงููุฉ |

### 3. ุฌุฏูู ุชูุงุนูุงุช ุงูุบุฐุงุก (`food_interactions`)

| # | ุงูุนููุฏ | ุงูููุน | ุงููุตู |
| :--- | :--- | :--- | :--- |
| 1 | `id` | INTEGER PK | ูุนุฑู ุงูุชูุงุนู |
| 2 | `med_id` | INTEGER | ูุนุฑู ุงูุฏูุงุก ุงููุฑุชุจุท |
| 3 | `trade_name` | TEXT | ุงุณู ุงูุฏูุงุก |
| 4 | `interaction` | TEXT | ูุต ุงูุชูุงุนู (En) |
| 5 | `ingredient` | TEXT | ุงููุงุฏุฉ ุงููุณุจุจุฉ |
| 6 | `severity` | TEXT | ุฏุฑุฌุฉ ุงูุฎุทูุฑุฉ |
| 7 | `management_text` | TEXT | ุชูุฌููุงุช ุงูุฅุฏุงุฑุฉ |
| 8 | `mechanism_text` | TEXT | ุดุฑุญ ุงูุขููุฉ |
| 9 | `reference_text` | TEXT | ุงููุฑุฌุน |
| 10 | `source` | TEXT | ุงููุตุฏุฑ (ุงูุชุฑุงุถู DrugBank) |
| 11 | `created_at` | INTEGER | ุทุงุจุน ุฒููู |

### 4. ุฌุฏูู ุชูุงุนูุงุช ุงูุฃูุฑุงุถ (`disease_interactions`)

| # | ุงูุนููุฏ | ุงูููุน | ุงููุตู |
| :--- | :--- | :--- | :--- |
| 1 | `id` | INTEGER PK | ูุนุฑู ุงูุชูุงุนู |
| 2 | `med_id` | INTEGER | ูุนุฑู ุงูุฏูุงุก |
| 3 | `trade_name` | TEXT | ุงุณู ุงูุฏูุงุก |
| 4 | `disease_name` | TEXT | ุงุณู ุงููุฑุถ ุงููุชุนุงุฑุถ ูุนู |
| 5 | `interaction_text` | TEXT | ุชูุงุตูู ุงูุชุนุงุฑุถ |
| 6 | `severity` | TEXT | ุฏุฑุฌุฉ ุงูุฎุทูุฑุฉ |
| 7 | `reference_text` | TEXT | ุงููุฑุฌุน ุงูุทุจู |
| 8 | `source` | TEXT | ุงููุตุฏุฑ (ุงูุชุฑุงุถู DDInter) |
| 9 | `created_at` | INTEGER | ุทุงุจุน ุฒููู |

### 5. ุฌุฏูู ุฅุฑุดุงุฏุงุช ุงูุฌุฑุนุงุช (`dosage_guidelines`)
ูุญุชูุธ ุจุจูุงูุงุช ุงูุฌุฑุนุงุช ูู ูุตุงุฏุฑ ููุซููุฉ ูุซู FDA/DailyMed.

| # | ุงูุนููุฏ | ุงูููุน | ุงููุตู |
| :--- | :--- | :--- | :--- |
| 1 | `id` | INTEGER PK | ูุนุฑู ุงูุณุฌู |
| 2 | `med_id` | INTEGER | ูุนุฑู ุงูุฏูุงุก |
| 3 | `dailymed_setid` | TEXT | ูุนุฑู ูุฌููุนุฉ DailyMed |
| 4 | `min_dose` | REAL | ุงูุฌุฑุนุฉ ุงูุฏููุง |
| 5 | `max_dose` | REAL | ุงูุฌุฑุนุฉ ุงููุตูู |
| 6 | `frequency` | INTEGER | ุงูุชูุฑุงุฑ ุงููููู |
| 7 | `duration` | INTEGER | ูุฏุฉ ุงูุนูุงุฌ |
| 8 | `instructions` | TEXT | ุชุนูููุงุช ุงูุงุณุชุฎุฏุงู |
| 9 | `condition` | TEXT | ุงูุญุงูุฉ ุงููุฑุถูุฉ ุงููุณุชูุฏูุฉ |
| 10 | `source` | TEXT | ุงููุตุฏุฑ |
| 11 | `is_pediatric` | INTEGER | ูู ูู ุฌุฑุนุฉ ุฃุทูุงูุ (0/1) |

### 6. ุฌุฏูู ููููุงุช ุงูุฃุฏููุฉ (`med_ingredients`)
ุฌุฏูู ุฑุจุท ูุชุณููู ุงูุจุญุซ ุนู ุงูุชูุงุนูุงุช (Normalization).

| # | ุงูุนููุฏ | ุงูููุน | ุงููุตู |
| :--- | :--- | :--- | :--- |
| 1 | `med_id` | INTEGER | ูุนุฑู ุงูุฏูุงุก (FK) |
| 2 | `ingredient` | TEXT | ุงููุงุฏุฉ ุงููุนุงูุฉ (NOCASE) |
| 3 | `updated_at` | INTEGER | ุทุงุจุน ุฒููู |

---

## ๐ก๏ธ ุงูููุงุฑุณ (Indexes)
ูุชุญุณูู ุฃุฏุงุก ุงูุจุญุซ:
- `drugs`: `trade_name`, `active`, `category`.
- `drug_interactions`: `ingredient1`, `ingredient2`, `pair`.
- ุงูุทูููุงุช: `med_id` ูู ุฌุฏุงูู ุงูุชูุงุนูุงุช ูุงูุฌุฑุนุงุช.
