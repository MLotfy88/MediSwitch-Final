# ุฃููุงุท ุงููุธุงู - MediSwitch (System Patterns)

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ (Architecture)

ูุนุชูุฏ ูุดุฑูุน **MediSwitch** ุนูู ูุจุงุฏุฆ **Clean Architecture** ูุถูุงู ูุตู ุงููุณุคูููุงุชุ ุณูููุฉ ุงูุตูุงูุฉุ ููุงุจููุฉ ุงูุงุฎุชุจุงุฑ. ูุชู ุชูุณูู ุงูุชุทุจูู ุฅูู ุซูุงุซ ุทุจูุงุช ุฑุฆูุณูุฉ:

```mermaid
graph TD
    UI[ุทุจูุฉ ุงูุนุฑุถ - Presentation Layer] --> Domain[ุทุจูุฉ ุงููุฌุงู - Domain Layer]
    Data[ุทุจูุฉ ุงูุจูุงูุงุช - Data Layer] --> Domain
    Data --> Remote[ูุตุฏุฑ ุจูุงูุงุช ุนู ุจุนุฏ - Cloudflare D1]
    Data --> Local[ูุตุฏุฑ ุจูุงูุงุช ูุญูู - SQLite]
```

### 1. ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer) - Flutter
ูุฐู ุงูุทุจูุฉ ูุณุคููุฉ ุนู ูู ูุง ูุฑุงู ุงููุณุชุฎุฏู ููุชูุงุนู ูุนู.
-   **ุงูุดุงุดุงุช (Screens)**: ูุงุฌูุงุช ุงูุชุทุจูู (UI).
-   **ุฅุฏุงุฑุฉ ุงูุญุงูุฉ (State Management)**: ูุณุชุฎุฏู `Provider` ูุจุณุงุทุชู ูููุงุกุชู.
-   **ุงูููุทู (Logic)**: ูุชู ูุตู ุงูููุทู ุนู ุงูุฑุณู ุจุงุณุชุฎุฏุงู ViewModels.

### 2. ุทุจูุฉ ุงููุฌุงู (Domain Layer) - Dart Pure
ุงูุทุจูุฉ ุงูุฌููุฑูุฉ (ุงููููุฉ) ุงููุณุชููุฉ ุนู ุฃู ุฅุทุงุฑ ุนูู ุฃู ูุงุนุฏุฉ ุจูุงูุงุช.
-   **ุงูููุงูุงุช (Entities)**: ููุงุฐุฌ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ูุซู `Drug`, `Interaction`).
-   **ุญุงูุงุช ุงูุงุณุชุฎุฏุงู (Use Cases)**: ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ (ูุซู "ุงูุจุญุซ ุนู ุฏูุงุก", "ูุฒุงููุฉ ุงูุจูุงูุงุช").
-   **ุงูุนููุฏ (Interfaces)**: ุชุนุฑููุงุช ูููููุฉ ุนูู ุงููุณุชูุฏุนุงุช (Repositories).

### 3. ุทุจูุฉ ุงูุจูุงูุงุช (Data Layer)
ุญููุฉ ุงููุตู ุจูู ุงูุชุทุจูู ููุตุงุฏุฑ ุงูุจูุงูุงุช.
-   **ุงููุณุชูุฏุนุงุช (Repositories)**: ุชูููุฐ ููุนููุฏ ุงููุญุฏุฏุฉ ูู ุทุจูุฉ ุงููุฌุงู.
-   **ุงููุตุงุฏุฑ (Data Sources)**:
    -   **ูุญูู (Local)**: `SQLite` (ููุชุฎุฒูู ุงูุฏุงุฆู) ู `SharedPreferences` (ููุฅุนุฏุงุฏุงุช).
    -   **ุณุญุงุจู (Cloud)**: `Cloudflare Worker API` (ูุณุญุจ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ).

---

## ๐งฉ ุฃููุงุท ุงูุชุตููู (Design Patterns)

1.  **Repository Pattern**:
    -   ูุตู ููุทู ุฌูุจ ุงูุจูุงูุงุช ุนู ูุงุฌูุฉ ุงููุณุชุฎุฏู. ูุณูุญ ุจุชุบููุฑ ูุตุฏุฑ ุงูุจูุงูุงุช (ูุซูุงู ูู API ุฅูู Cache) ุฏูู ุงูุชุฃุซูุฑ ุนูู ุงูุดุงุดุงุช.

2.  **Singleton Pattern**:
    -   ูุณุชุฎุฏู ููุฎุฏูุงุช ุงูุชู ูุฌุจ ุฃู ูููู ููุง ูุณุฎุฉ ูุงุญุฏุฉ ููุท ุทูุงู ุญูุงุฉ ุงูุชุทุจููุ ูุซู `NetworkClient` ู `DatabaseHelper`.

3.  **Adapter Pattern**:
    -   ุชุญููู ุงูุจูุงูุงุช ุงููุงุฏูุฉ ูู API (JSON) ุฅูู ููุงุฐุฌ Dart (Models) ูุงูุนูุณ.

4.  **Observer Pattern**:
    -   ูุณุชุฎุฏู `ChangeNotifier` ูุชุญุฏูุซ ุงููุงุฌูุฉ ุชููุงุฆูุงู ุนูุฏ ุชุบูุฑ ุงูุจูุงูุงุช (ูุซูุงู ุนูุฏ ุงูุชูุงุก ุงูุชุญููู ุฃู ุญุฏูุซ ุฎุทุฃ).

5.  **Offline-First Strategy**:
    -   ุงูุชุทุจูู ูุนุชูุฏ ุฃููุงู ุนูู ุงูุจูุงูุงุช ุงููุญููุฉ. ุงููุฒุงููุฉ ุชุญุฏุซ ูู ุงูุฎูููุฉุ ููุง ูุถูู ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณุฑูุนุฉ ุฌุฏุงู.

---

## โ๏ธ ุงููุฑุงุฑุงุช ุงูุชูููุฉ ุงูุฑุฆูุณูุฉ

### ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Flutter)
-   **ุฅุฏุงุฑุฉ ุงูุญุงูุฉ**: ุชู ุงุฎุชูุงุฑ `Provider` ูุฃูู ุงูุฎูุงุฑ ุงูุฑุณูู ุงูููุตู ุจู ูู Google ูููุดุงุฑูุน ูุชูุณุทุฉ ุงูุญุฌูุ ููุฃูู ูููู ูู ุงูุชุนููุฏ (Boilerplate).
-   **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: `sqflite` ูู ุงูุฎูุงุฑ ุงูุฃูุถู ููุฃุฏุงุก ุงูุนุงูู ูุน ูููุงุช ุจูุงูุงุช ูุจูุฑุฉ (23,000+ ุฏูุงุก) ููุงุฑูุฉ ุจู Hive ุฃู SharedPreferences.

### ุงููุงุฌูุฉ ุงูุฎูููุฉ (Serverless)
-   **Cloudflare Workers**: ุชู ุงุณุชุจุฏุงู ุงูุฎูุงุฏู ุงูุชูููุฏูุฉ (VPS/Django) ุจู Workers ูุชูููู ุงูุชูููุฉ ุฅูู ุงูุตูุฑ ุชูุฑูุจุงู ูุฒูุงุฏุฉ ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ ุนุงูููุงู.
-   **Cloudflare D1**: ูุงุนุฏุฉ ุจูุงูุงุช SQL ููุฒุนุฉุ ุชุชูุงูู ุชูุงูุงู ูุน SQLite ุงููุณุชุฎุฏู ูู ุงูุชุทุจููุ ููุง ูุณูู ุงููุฒุงููุฉ.

## ๐ ุชุฏูู ุงูุจูุงูุงุช (Data Sync Flow)

1.  **ุทูุจ ุงูุชุญุฏูุซ**: ุงูุชุทุจูู ูุทูุจ `/api/sync` ููุฑุณู ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ ูุฏูู.
2.  **ุญุณุงุจ ุงููุฑููุงุช**: ุงูู Worker ูุณุชุนูู ูุงุนุฏุฉ D1 ุนู ุงูุณุฌูุงุช ุงูุชู ุชู ุชุนุฏูููุง ุจุนุฏ ูุฐุง ุงูุชุงุฑูุฎ.
3.  **ุงูุงุณุชุฌุงุจุฉ**: ุงูู Worker ูุนูุฏ ููุท ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ (JSON).
4.  **ุงูุชุฎุฒูู**: ุงูุชุทุจูู ูุญูุธ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูู SQLite ููุญุฏุซ ุชุงุฑูุฎ "ุขุฎุฑ ูุฒุงููุฉ".
