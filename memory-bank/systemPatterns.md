# ุฃููุงุท ุงููุธุงู - MediSwitch (System Patterns)

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ (Architecture)

ูุนุชูุฏ ูุดุฑูุน **MediSwitch** ุนูู ูุจุงุฏุฆ **Clean Architecture** ูุถูุงู ูุตู ุงููุณุคูููุงุชุ ุณูููุฉ ุงูุตูุงูุฉุ ููุงุจููุฉ ุงูุงุฎุชุจุงุฑ. ูุชู ุชูุณูู ุงูุชุทุจูู ุฅูู ุซูุงุซ ุทุจูุงุช ุฑุฆูุณูุฉ:

```mermaid
graph TD
    UI[ุทุจูุฉ ุงูุนุฑุถ - Presentation Layer] --> Domain[ุทุจูุฉ ุงููุฌุงู - Domain Layer]
    Data[ุทุจูุฉ ุงูุจูุงูุงุช - Data Layer] --> Domain
    Data --> Remote[ูุตุฏุฑ ุจูุงูุงุช ุนู ุจุนุฏ - Cloudflare Worker]
    Data --> Local[ูุตุฏุฑ ุจูุงูุงุช ูุญูู - SQLite]
```

### 1. ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer) - Flutter
ูุฐู ุงูุทุจูุฉ ูุณุคููุฉ ุนู ูู ูุง ูุฑุงู ุงููุณุชุฎุฏู ููุชูุงุนู ูุนู.
-   **ุงูุดุงุดุงุช (Screens)**: ุตูุญุงุช ุงูุชุทุจูู ุงููุงููุฉ.
-   **ุฅุฏุงุฑุฉ ุงูุญุงูุฉ (State Management)**: ูุณุชุฎุฏู `Provider` ูุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุชุทุจูู.
-   **ุงูููุทู (Logic)**: ูุชู ูุตู ููุทู ุงูุนุฑุถ ูู ูุฆุงุช `Provider` (ViewModels).

### 2. ุทุจูุฉ ุงููุฌุงู (Domain Layer) - Dart Pure
ูุฐู ูู ุงูุทุจูุฉ ุงูุฌููุฑูุฉ ููุชุทุจููุ ููู ูุณุชููุฉ ุชูุงููุง ุนู ุฃู ุฅุทุงุฑ ุนูู.
-   **ุงูููุงูุงุช (Entities)**: ุชูุซู ูุงุฆูุงุช ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ูุซู `DrugEntity`).
-   **ุญุงูุงุช ุงูุงุณุชุฎุฏุงู (Use Cases)**: ุชูุซู ุงูุนูููุงุช (ูุซู `SearchDrugs`, `SyncData`).
-   **ูุงุฌูุงุช ุงููุณุชูุฏุนุงุช (Repository Interfaces)**: ุนููุฏ ุชุญุฏุฏ ููููุฉ ุงููุตูู ููุจูุงูุงุช.

### 3. ุทุจูุฉ ุงูุจูุงูุงุช (Data Layer) - Dart & Cloudflare
ูุฐู ุงูุทุจูุฉ ูุณุคููุฉ ุนู ุชูููุฑ ุงูุจูุงูุงุช ููุชุทุจูู.
-   **ุงููุณุชูุฏุนุงุช (Repositories)**: ุชุฑุจุท ุจูู ูุตุงุฏุฑ ุงูุจูุงูุงุช ูุทุจูุฉ ุงููุฌุงู.
-   **ูุตุงุฏุฑ ุงูุจูุงูุงุช (Data Sources)**:
    -   **ูุญูู (Local)**: `SQLite` ู `SharedPreferences` ููุนูู Offline-First.
    -   **ุณุญุงุจู (Cloud)**: `Cloudflare Worker API` ูููุฒุงููุฉ ูุงูุฅุนุฏุงุฏุงุช.

## ๐งฉ ุฃููุงุท ุงูุชุตููู (Design Patterns)

1.  **Repository Pattern**: ูุตู ุงูุจูุงูุงุช ุนู ุงูููุทู.
2.  **Add-on Architecture**: ุงูุชุนุงูู ูุน ุงูุฅุนูุงูุงุช ูุงูููุฒุงุช ุงูุฅุถุงููุฉ ูุฎุฏูุงุช ูุณุชููุฉ (Services).
3.  **Singleton**: ูุฅุฏุงุฑุฉ ุงูุฎุฏูุงุช ุงูุนุงูุฉ (NetworkInfo, AdService).
4.  **Observer**: ุชุญุฏูุซ ุงููุงุฌูุฉ ุชููุงุฆูุงู ุนุจุฑ `ChangeNotifier`.
5.  **Multi-Table Bridge**: ุงุณุชุฎุฏุงู ุฌุฏูู `med_ingredients` ูุฑุจุท ุงูุฃุฏููุฉ ุจุชูุงุนูุงุชูุง ุนุจุฑ ุงููุงุฏุฉ ุงููุนุงูุฉ (Many-to-Many).
6.  **Smart Classification Mapping**: ุงุณุชุฎุฏุงู `CategoryMapperHelper` ูุฑุจุท ุงูุชุตูููุงุช ุงููุฑุนูุฉ ุจุชุตูููุงุช ุฑุฆูุณูุฉ ููุญุฏุฉ ูุงูุชุฑุงุญ ุจุฏุงุฆู ุฐููุฉ.

## โ๏ธ ุงููุฑุงุฑุงุช ุงูุชูููุฉ ุงูุฑุฆูุณูุฉ

### ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend - Flutter)
-   **State Management**: `Provider` ููููุงุกุฉ ูุงูุจุณุงุทุฉ.
-   **Offline-First**: ุงูุงุนุชูุงุฏ ุงูุฃุณุงุณู ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉุ ูุน ุงููุฒุงููุฉ ุงูุฎูููุฉ (Delta Sync/Background Fetch).
-   **Database**: `sqflite` ูุฃุฏุงุก ุนุงูู ูู ุงูุจุญุซ ูุงูููุชุฑุฉ ุงููุญููุฉ.

### ุงููุงุฌูุฉ ุงูุฎูููุฉ (Backend - Serverless)
-   **Architecture**: `Cloudflare Workers` ุจุฏูุงู ูู ุงูุฎูุงุฏู ุงูุชูููุฏูุฉ ูุชูููู ุงูุชูููุฉ ูุฒูุงุฏุฉ ุงูุณุฑุนุฉ (Edge Computing).
-   **Database**: `Cloudflare D1` (Distributed SQLite) ูุชูุงูู ููุชุงุฒ ูุน SQLite ุงููุญูู ูู ุงูุชุทุจูู.
-   **Admin Dashboard**: `Cloudflare Pages` ูุงุณุชุถุงูุฉ ููุญุฉ ุชุญูู React ุฎูููุฉ ูุณุฑูุนุฉ.

## ๐ ุชุฏูู ุงูุจูุงูุงุช (Data Flow)

ูุซุงู: **ูุฒุงููุฉ ุงูุชุบููุฑุงุช (Sync)**
1.  **Flutter App**: ูุฑุณู `last_update_timestamp` ุฅูู `/api/sync/delta`.
2.  **Worker**: ูุณุชุนูู D1 ุนู ุงูุชุบููุฑุงุช ุงูุชู ุญุฏุซุช ุจุนุฏ ูุฐุง ุงูุชูููุน ุงูุฒููู.
3.  **D1**: ูุนูุฏ ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ/ุงููุนุฏูุฉ ููุท (Delta).
4.  **Worker**: ูุฑุณู ุงูุจูุงูุงุช ูุถุบูุทุฉ (JSON).
5.  **Flutter App**: ูุณุชูุจู ุงูุจูุงูุงุชุ ูุญุฏุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ SQLiteุ ููุญูุธ ุงูุทุงุจุน ุงูุฒููู ุงูุฌุฏูุฏ.

## ๐ก๏ธ ุงูุฃูุงู (Security)
-   **API**: ุฌููุน ุงูุงุชุตุงูุงุช ูุดูุฑุฉ ุนุจุฑ HTTPS.
-   **Admin**: ูุตุงุฏูุฉ ูููุฉ ูููุดุฑููู.
-   **Protection**: ุญูุงูุฉ ุงูู Token ูุฅุฎูุงุก ููุงุชูุญ ุงูู Production.
