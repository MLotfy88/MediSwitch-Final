# خيارات التحكم في الواجهة الأمامية من الواجهة الخلفية

توضح هذه الوثيقة الإمكانيات والاعتبارات للتحكم في مظهر واجهة مستخدم تطبيق Flutter من الواجهة الخلفية (Backend) المبنية بـ Django.

## ملخص

على الرغم من أنه من الممكن تقنيًا التحكم في العديد من جوانب واجهة المستخدم من الواجهة الخلفية، إلا أنه يوصى عمومًا بإبقاء التخطيط الأساسي والأنماط داخل تطبيق Flutter نفسه (باستخدام `ThemeData` وأنماط الويدجتس) لتحسين الأداء وقابلية الصيانة وتجربة المطور.

حالة الاستخدام الأكثر عملية للتحكم في واجهة المستخدم من الواجهة الخلفية هي إدارة **خصائص على مستوى السمة (Theme)**، وبشكل أساسي الألوان، وربما علامات الميزات (feature flags) التي تؤثر على عناصر واجهة المستخدم.

## خيارات التحكم الممكنة من الواجهة الخلفية

هذه هي العناصر التي *يمكن* التحكم فيها بشكل واقعي عبر نقطة نهاية (endpoint) للتكوين في الواجهة الخلفية (على سبيل المثال، توسيع نقطة النهاية الحالية `GeneralConfig`):

1.  **ألوان السمة (Theme Colors):**
    *   **المفهوم:** تحديد لوحة الألوان الرئيسية المستخدمة في جميع أنحاء التطبيق. ستقوم الواجهة الخلفية بتوفير رموز الألوان السداسية العشرية (hex codes) (مثل `#16BC88`، `#FFFFFF`).
    *   **الخصائص:**
        *   `primaryColor`: لون العلامة التجارية الرئيسي (للأزرار، العناصر المميزة).
        *   `secondaryColor`: اللون الثانوي أو لون التمييز.
        *   `backgroundColor`: لون خلفية الشاشة الافتراضي.
        *   `surfaceColor`: لون الخلفية للبطاقات، مربعات الحوار، الألواح السفلية.
        *   `errorColor`: لون رسائل/مؤشرات الخطأ.
        *   `onPrimaryColor`: لون النص/الأيقونة فوق خلفية `primaryColor`.
        *   `onSecondaryColor`: لون النص/الأيقونة فوق خلفية `secondaryColor`.
        *   `onBackgroundColor`: لون النص الافتراضي فوق خلفية `backgroundColor`.
        *   `onSurfaceColor`: لون النص الافتراضي فوق خلفية `surfaceColor`.
        *   `onErrorColor`: لون النص/الأيقونة فوق خلفية `errorColor`.
        *   `borderColor`: لون الحدود الافتراضي.
    *   **التنفيذ:** يقوم تطبيق Flutter بجلب هذه الألوان عند بدء التشغيل وينشئ/يحدث `ColorScheme` الخاص بـ `ThemeData` ديناميكيًا.

2.  **تجاوز وضع السمة (اختياري):**
    *   **المفهوم:** السماح للواجهة الخلفية بفرض وضع الإضاءة (Light) أو الوضع الداكن (Dark) على التطبيق، متجاوزًا إعدادات الجهاز أو الإعدادات داخل التطبيق للمستخدم.
    *   **الخاصية:** `forcedThemeMode` (مثل 'light', 'dark', 'system').
    *   **التنفيذ:** يتحقق تطبيق Flutter من هذه القيمة ويضبط `ThemeMode` بناءً عليها.

3.  **اختيار عائلة الخطوط (محدود):**
    *   **المفهوم:** التبديل بين مجموعة محددة مسبقًا من عائلات الخطوط المضمنة بالفعل في التطبيق.
    *   **الخاصية:** `selectedFontFamily` (مثل 'NotoSansArabic', 'Roboto').
    *   **التنفيذ:** يستخدم تطبيق Flutter هذه القيمة في `ThemeData.fontFamily`. **ملاحظة:** لا يمكن استخدام هذا لتحميل خطوط *جديدة* من الواجهة الخلفية.

4.  **قيم التكوين العامة (استخدم بحذر):**
    *   **المفهوم:** تحديد قيم عامة تُستخدم بشكل متسق.
    *   **الخصائص:**
        *   `cardBorderRadius`: قيمة واحدة (مثل 12.0) تُطبق على جميع البطاقات.
        *   `defaultPadding`: قيمة حشوة (padding) أساسية (مثل 16.0) تُستخدم للمسافات العامة.
    *   **التنفيذ:** يتطلب تنفيذًا دقيقًا في Flutter لاستخدام هذه القيم بشكل متسق. أقل مرونة من تحديدها في سمات Flutter.

## الخيارات الأقل جدوى / غير الموصى بها

التحكم في هذه العناصر من الواجهة الخلفية يضيف تعقيدًا كبيرًا ولا يوصى به بشكل عام:

*   **أحجام/حشوات ويدجتس محددة:** تحديد `width` أو `height` أو `padding` لويدجتس فردية (مثل "اجعل بطاقة الدواء الشائع بعرض 150 بكسل"). هذا يجعل التخطيط هشًا للغاية.
*   **تنسيق نصوص فردية:** تعيين حجم الخط أو وزنه أو لونه لعناصر نصية محددة (مثل "اجعل عنوان الدواء غامقًا بحجم 16 بكسل، ولكن السعر عادي بحجم 12 بكسل"). يجب التعامل مع هذا بواسطة `TextTheme` في `ThemeData` الخاص بـ Flutter.
*   **خلفيات معقدة:** تحديد تدرجات لونية، عناوين URL للصور، وما إلى ذلك، لخلفيات الويدجتس.
*   **هيكل/رؤية الويدجتس:** تحديد *أي* الويدجتس يجب عرضها أو كيفية تداخلها (استخدم علامات الميزات لتبديل الرؤية البسيط بدلاً من ذلك).

## التوصية

ركز على التحكم في **ألوان السمة (Theme Colors)** عبر الواجهة الخلفية. يوفر هذا توازنًا جيدًا بين التحكم الديناميكي دون تعقيد كود الواجهة الأمامية بشكل مفرط.

1.  **الواجهة الخلفية (Backend):** قم بتوسيع نموذج `GeneralConfig` ونقطة نهاية API في Django لتشمل حقولًا لألوان السمة الأساسية (primary, secondary, background, surface, onPrimary, onSecondary, onBackground, onSurface, إلخ). قم بتوفير قيم افتراضية معقولة.
2.  **الواجهة الأمامية (Frontend):**
    *   قم بتعديل `SettingsProvider` (أو `ThemeProvider` مخصص).
    *   قم بجلب `GeneralConfig` عند بدء تشغيل التطبيق (بعد جلب الإعدادات الحالية).
    *   استخدم الألوان التي تم جلبها (أو القيم الافتراضية في حالة فشل الجلب) لإنشاء `ColorScheme` المستخدم في `_buildThemeData` في `main.dart` ديناميكيًا.
    *   تأكد من أن التطبيق يمكنه التعامل بأمان مع قيم الألوان المفقودة أو غير الصالحة من الواجهة الخلفية.

يسمح هذا النهج بتعديل نظام الألوان الرئيسي دون الحاجة إلى تحديث التطبيق، مع الحفاظ على التخطيط والتصميم التفصيلي داخل قاعدة كود Flutter حيث يكون إدارتها أسهل.