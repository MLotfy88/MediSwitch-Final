// android/app/build.gradle (الكود المعدل)

plugins {
    id 'com.android.application'
    id 'kotlin-android'
    // تطبيق إضافة Flutter في النهاية
    id 'dev.flutter.flutter-gradle-plugin'
}

// لا حاجة لقراءة local.properties هنا لـ versionCode/Name
// إضافة Flutter ستقوم بذلك بناءً على pubspec.yaml

android {
    namespace "com.example.mediswitch" // تأكد من الـ namespace
    // *** تمت إعادة إضافة compileSdk هنا ***
    compileSdk 35

    signingConfigs {
         debug {
             storeFile file("${System.getProperty('user.home')}/.android/debug.keystore")
             storePassword "android"
             keyAlias "androiddebugkey"
             keyPassword "android"
         }
         // release { ... } // للتوقيع الحقيقي لاحقًا
     }

    defaultConfig {
        applicationId "com.example.mediswitch" // تأكد من الـ ID
        minSdk 28
        targetSdk 35
        // *** تم حذف الأسطر التالية للسماح لإضافة Flutter بالتحكم ***
        // versionCode flutterVersionCode.toInteger()
        // versionName flutterVersionName
    }

    buildTypes {
        release {
            signingConfig signingConfigs.debug // مؤقتًا لبناء CI
            minifyEnabled true // أو false
            shrinkResources false // أو true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
        // debug { ... }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }

    kotlinOptions {
        // استخدام نص مباشر أكثر أمانًا
        jvmTarget = '17'
    }

    // تأكد من عدم وجود أي عمليات أخرى قد تسبب خطأ substring()
}

dependencies {
    implementation 'com.google.android.play:core:1.10.3'
    // إضافة مكتبة Kotlin القياسية بشكل صريح (ممارسة جيدة)
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
}

flutter {
    source '../..'
}
