# دليل استخدام الواجهة الخلفية (Backend) لـ MediSwitch

هذا الدليل يشرح كيفية استخدام الواجهة الخلفية (Backend) لتطبيق MediSwitch بعد نشرها بنجاح على الخادم.

## الوصول إلى لوحة التحكم (Django Admin)

*   **الرابط:** يمكنك الوصول إلى لوحة التحكم الرئيسية عبر متصفح الويب باستخدام عنوان IP الخاص بالخادم متبوعاً بـ `/admin/`:
    `http://37.27.185.59/admin/`
*   **تسجيل الدخول:** استخدم بيانات المستخدم المدير (superuser) التي قمت بإنشائها أثناء عملية الإعداد.
    *   اسم المستخدم الافتراضي (إذا لم تغيره): `admin`
    *   كلمة المرور الافتراضية (إذا لم تغيرها): `admin123`
    *   **هام:** يوصى بشدة بتغيير كلمة المرور الافتراضية فور تسجيل الدخول لأول مرة.

## الوظائف المتاحة في لوحة التحكم

لوحة تحكم Django Admin توفر واجهة رسومية لإدارة البيانات والإعدادات المختلفة للتطبيق. الأقسام الرئيسية التي ستجدها (بناءً على النماذج Models الموجودة في `backend/api/models.py`):

1.  **Api:** (هذا هو اسم التطبيق Django الخاص بنا)
    *   **Active Data Files:** (لا يُستخدم حالياً بشكل مباشر بعد الانتقال لقاعدة بيانات Backend).
    *   **Ad Mob Configs:** لإدارة إعدادات إعلانات AdMob.
        *   يمكنك تعديل معرفات الوحدات الإعلانية (Ad Unit IDs) لنظامي Android و iOS (لإعلانات البانر والإعلانات البينية).
        *   يمكنك تفعيل أو تعطيل الإعلانات بشكل عام (`Ads enabled`).
    *   **Analytics Events:** لعرض سجلات الأحداث التحليلية التي يرسلها تطبيق Flutter (مثل عمليات البحث، عرض تفاصيل دواء).
    *   **Drugs:** **(الأهم)** لإدارة بيانات الأدوية المخزنة في قاعدة بيانات الـ Backend.
        *   **عرض وتعديل:** يمكنك عرض قائمة الأدوية الحالية، البحث فيها، وتعديل بيانات أي دواء (الاسم التجاري، الاسم العربي، السعر، المكونات الفعالة، الفئة، الشركة، إلخ).
        *   **إضافة دواء جديد:** يمكنك إضافة دواء جديد يدوياً عن طريق ملء الحقول المطلوبة.
        *   **حذف دواء:** يمكنك حذف أدوية موجودة.
    *   **General Configs:** لإدارة الإعدادات العامة للتطبيق.
        *   يمكنك تعديل روابط "من نحن" (About URL)، "سياسة الخصوصية" (Privacy policy URL)، و "شروط الخدمة" (Terms of service URL).
    *   **Subscription Statuses:** (نموذج مبدئي) لإدارة حالة اشتراكات المستخدمين (مجاني/مميز).

2.  **Authentication and Authorization:**
    *   **Groups:** لإدارة مجموعات المستخدمين وصلاحياتهم (إذا احتجت لذلك مستقبلاً).
    *   **Users:** لإدارة مستخدمي لوحة التحكم (مثل المستخدم `admin`). يمكنك إضافة مستخدمين جدد، تغيير كلمات المرور، وتعيين الصلاحيات (مثل `is_staff` للسماح بالدخول للوحة التحكم، و `is_superuser` لإعطاء كافة الصلاحيات).

## تحديث بيانات الأدوية (عبر الواجهات المخصصة)

بالإضافة إلى إدارة الأدوية يدوياً عبر قسم `Drugs` في لوحة التحكم، تم إنشاء واجهات مخصصة لرفع ملفات CSV/Excel لتحديث البيانات بشكل جماعي:

*   **الوصول:**
    *   **تسجيل الدخول:** تحتاج أولاً لتسجيل الدخول إلى لوحة التحكم الرئيسية (`/admin/`) باستخدام حساب المدير.
    *   **رابط صفحة الرفع:** بعد تسجيل الدخول، انتقل يدوياً إلى الرابط التالي في نفس المتصفح:
        `http://37.27.185.59/api/admin/upload/`
*   **الوظائف المتاحة في صفحة الرفع:**
    *   **رفع ملف بيانات رئيسي (CSV/XLSX):**
        *   **السلوك:** سيقوم هذا الخيار **بمسح جميع بيانات الأدوية الحالية** في قاعدة بيانات الـ Backend واستبدالها بالبيانات الموجودة في الملف المرفوع.
        *   **الاستخدام:** يُستخدم عند الحاجة لتحديث شامل وكامل لقاعدة البيانات بناءً على ملف جديد.
        *   **التحقق:** يتم التحقق من صحة تنسيق الملف والأعمدة المطلوبة قبل المعالجة.
    *   **رفع ملف لتحديث الأسعار فقط (CSV/XLSX):**
        *   **السلوك:** سيقوم هذا الخيار بتحديث أسعار الأدوية الموجودة فقط بناءً على البيانات في الملف المرفوع (عادةً ما يتطابق حسب الاسم التجاري). لن يتم إضافة أدوية جديدة أو حذف أدوية غير موجودة في الملف.
        *   **الاستخدام:** يُستخدم لتحديثات الأسعار الدورية.
    *   **رفع ملف لإضافة أدوية جديدة فقط (CSV/XLSX):**
        *   **السلوك:** سيقوم هذا الخيار بإضافة الأدوية الجديدة الموجودة في الملف المرفوع إلى قاعدة البيانات الحالية. لن يتم تحديث الأدوية الموجودة بالفعل أو حذف أي شيء.
        *   **الاستخدام:** يُستخدم لإضافة دفعات جديدة من الأدوية دون التأثير على البيانات الحالية.

**ملاحظات هامة حول رفع الملفات:**

*   تأكد من أن تنسيق ملف CSV أو XLSX يطابق الأعمدة المتوقعة من قبل الـ Backend (راجع الكود في `backend/api/views.py` لمعرفة الأعمدة المطلوبة لكل عملية).
*   قد تستغرق عملية المعالجة بعض الوقت حسب حجم الملف.

## الوصول إلى API

*   يمكن لتطبيق Flutter (أو أي عميل آخر) الوصول إلى نقاط نهاية API المختلفة التي يوفرها الـ Backend.
*   الرابط الأساسي للـ API هو: `http://37.27.185.59/api/`
*   بعض نقاط النهاية الهامة (راجع `backend/api/urls.py` للقائمة الكاملة):
    *   `/api/drugs/download/`: لتحميل قائمة الأدوية الكاملة (للمزامنة مع التطبيق).
    *   `/api/config/general/`: للحصول على الإعدادات العامة.
    *   `/api/config/ads/`: للحصول على إعدادات AdMob.
    *   `/api/analytics/log/`: لإرسال أحداث تحليلية من التطبيق.

بهذا الدليل، يمكنك إدارة الواجهة الخلفية وتحديث بيانات الأدوية بفعالية.